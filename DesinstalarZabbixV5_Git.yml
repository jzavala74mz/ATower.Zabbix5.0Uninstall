---
  ## Desinstalar la aplicación Zabbix segun los servidores establecidos desde A-Tower
  - name: DESINSTALAR LA APLICACIÓN ZABBIX EN SU VERSIÓN 5.0 DESDE RED HAT8/CENTOS 8
    hosts: all
    vars:
            repo_tag: zabbix_bdd
            vars:
            app_nombre_zabbix: zabbix

    tasks:
            - name: Validar si actualmente se encuentra instalada la solución del zabbix
              service_facts:
            - debug:
                    msg: '{{ app_nombre_zabbix }} Instalado --> DESINSTALAR'
              when: "'zabbix' in services"
                      
            - name: Desinstalar Zabbix en caso de estar instalado
              dnf:
                    name: ['zabbix', 'zabbix-release', 'zabbix-server', 'zabbix-server-mysql', 'zabbix-web', 'zabbix-web-mysql', 'onapp-zabbix']
                    state: removed

            - name: Renombramos el archivo /etc/httpd/conf.d/onapp-zabbix.conf a un respaldo
              command: mv /etc/httpd/conf.d/onapp-zabbix.conf /etc/httpd/conf.d/onapp-zabbix.conf.rpmsave

            - name: Reestablecer el servidor de apache
              service:
                    name: httpd
                    state: restarted


